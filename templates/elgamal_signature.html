<!DOCTYPE html>
<html lang="en">
    <head>

    </head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Elgamal Signature</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/bootstrap.css') }}">
    <body>
        <script src="{{ url_for('static', filename='js/bootstrap.bundle.min.js') }}"></script>

        <header>
            <nav class="navbar fixed-top navbar-expand-lg bg-dark navbar-dark">
                <div class="container-fluid">
                  <!-- link to homescreen -->
                  <a class="navbar-brand" href="#">
                    <img src="" alt="">
                    INT3230E
                  </a>
                  <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                  </button>
                  <div class="collapse navbar-collapse" id="navbarSupportedContent">
                    <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="true">
                              RSA
                            </a>
                            <ul class="dropdown-menu">
                                <li><a class="dropdown-item" href="/">RSA</a></li>
                                <li><hr class="dropdown-divider"></li>
                              <li><a class="dropdown-item" href="/rsa-signature">RSA Digital Signature</a></li>
                            </ul>
                        </li>
          
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="true">
                              ElGammal
                            </a>
                            <ul class="dropdown-menu">
                                <li><a class="dropdown-item" href="/elgammal">Elgammal</a></li>
                                <li><hr class="dropdown-divider"></li>
                              <li><a class="dropdown-item" href="/elgammal-signature">Elgammal Digital Signature</a></li>
                            </ul>
                        </li>
          
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="true">
                              Elliptic
                            </a>
                            <ul class="dropdown-menu">
                                <li><a class="dropdown-item" href="/elliptic">ECC</a></li>
                                <li><hr class="dropdown-divider"></li>
                              <li><a class="dropdown-item" href="/elliptic-signature">ECC Digital Signature</a></li>
                            </ul>
                        </li>
          
                        <li class="nav-item dropdown">
                          <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="true">
                            Fundamentals
                          </a>
                          <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="/euclid">Euclid algorithm</a></li>
                            <li><a class="dropdown-item" href="/primality">Primality test</a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item" href="other.html">Something else here</a></li>
                          </ul>
                        </li>
                      </ul>
                  </div>
                </div>
            </nav>
        </header>

        <main class="pt-5">
            <div class="container mt-">
                
                <h1 class="text-center mt-5">Elgamal Digital Signature</h1>
                
                <div class="d-flex justify-content-center my-5">
                    <div class="col">
                      <div class="bg-secondary text-white card">
                        <div class="card-body">
                            <!-- <h2 class="text-center">Primality test</h2> -->
                           <p>The ElGamal signature scheme is a digital signature scheme which is based on the difficulty of computing discrete
                            logarithms. It was described by Taher ElGamal in 1984. It is based on the Diffie–Hellman problem.</p>
                        </div>
                      </div>
                    </div>
                </div>

                <div class="d-flex justify-content-center my-5">
                    <div class="col">
                      <div class="bg-secondary text-white card">
                        <div class="card-body">
                            <!-- <h2 class="text-center">Primality test</h2> -->
                           <p>The ElGamal signature scheme is a digital signature scheme based on the algebraic properties of modular exponentiation, together with the discrete logarithm problem. The algorithm uses a key pair consisting of a public key and a private key. The private key is used to generate a digital signature for a message, and such a signature can be verified by using the signer's corresponding public key. The digital signature provides message authentication (the receiver can verify the origin of the message), integrity (the receiver can verify that the message has not been modified since it was signed) and non-repudiation (the sender cannot falsely claim that they have not signed the message).</p>
                        </div>
                      </div>
                    </div>
                </div>

                
                <h1 class="text-center mt-5">Example</h1>

                <div class="card-group mt-5">

                    <div class="card">
                        <div class="card-header">
                            <h4>Bob</h4>
                        </div>
                        <div class="card-body">

                            <!-- connect here: id="Elgammal system setting" -->
                            <form id="system1_setting">
                                <div class="mb-3 row">
                                    <label for="primeP1" class="col-sm-2 col-form-label"><i>p</i> =</label>
                                    <div class="col-sm-10">
                                        <!-- connect here: id="p1" -->
                                        <input type="number" class="form-control" id="p1" placeholder="11" required />
                                    </div>
                                </div>

                                <div class="mb-3 row">
                                    <label for="alpha1" class="col-sm-2 col-form-label"><i>&alpha;</i> =</label>
                                    <div class="col-sm-10">
                                        <!-- connect here: id="alpha1" -->
                                        <!--<input type="number" class="form-control" id="alpha1" placeholder="2" required />-->
                                        <span id="alpha1"></span>
                                    </div>
                                </div>

                                <div class="mb-3 row">
                                    <label for="privateKey1" class="col-sm-2 col-form-label">Private key:</label>
                                    <div class="col-sm-10">
                                        <!-- connect here: id="privateKey1" -->
                                        <input type="number" class="form-control" id="privateKey1" placeholder="3" required />
                                    </div>
                                </div>

                                <div class="mb-3 row">
                                    <label for="message1" class="col-sm-2 col-form-label">Message:</label>
                                    <div class="col-sm-10">
                                        <!-- connect here: id="message1" -->
                                        <input type="text" class="form-control" id="message1" placeholder="Hello Alice" required />
                                    </div>
                                </div>


                                <div class="d-flex justify-content-begin">
                                    <!-- connect here: handle form submission -->
                                    <button type="submit" class="btn btn-primary">Submit</button>
                                </div>
                            </form>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h4>Alice</h4>
                        </div>
                        <div class="card-body">

                            <!-- connect here: id="Elgammal system setting" -->
                            <form id="system2_setting">
                                <div class="mb-3 row">
                                    <label for="primeP2" class="col-sm-2 col-form-label"><i>p</i> =</label>
                                    <div class="col-sm-10">
                                        <!-- connect here: id="p2" -->
                                        <input type="number" class="form-control" id="p2" placeholder="11" required />
                                    </div>
                                </div>

                                <div class="mb-3 row">
                                    <label for="alpha2" class="col-sm-2 col-form-label"><i>&alpha;</i> =</label>
                                    <div class="col-sm-10">
                                        <!-- connect here: id="alpha2" 
                                        <input type="number" class="form-control" id="alpha2" placeholder="2" required />-->
                                        <span id = "alpha2"></span>
                                    </div>
                                </div>

                                <div class="mb-3 row">
                                    <label for="publicKey2" class="col-sm-2 col-form-label">Private key:</label>
                                    <div class="col-sm-10">
                                        <!-- connect here: id="privateKey2" -->
                                        <input type="number" class="form-control" id="privateKey2" placeholder="4" required />
                                    </div>
                                </div>

                                <div class="mb-3 row">
                                    <label for="message2" class="col-sm-2 col-form-label">Message:</label>
                                    <div class="col-sm-10">
                                        <!-- connect here: id="message2" -->
                                        <input type="text" class="form-control" id="message2" placeholder="Hello Alice" required />
                                    </div>
                                </div>

                

                                <div class="d-flex justify-content-begin">
                                    <!-- connect here: handle form submission -->
                                    <button type="submit" class="btn btn-primary">Submit</button>
                                </div>

                            </form>
                        </div>
                    </div>

                </div>

                <!-- From Bob to Alice  -->
                <div class="card my-5">
                    <div class="card-header">
                        <h4>From: Bob, to: Alice</h4>
                    </div>
                    <div class="card-body">
                        <h6 class="fw-bold">&rArr; Sending & Receving Process:</h6>
                        <div class="card-group mt-3">

                            <div class="card">
                                <div class="card-header">
                                    <h5 class="text-center">Sender</h5>
                                </div>
                                <div class="card-body">
                                    <p class="card-text">Bob sends the message to Alice.</p>
                                    <!-- conect here: id="signature1" -->
                                    <p class="card-text">Sender: Bob</p>
                                    <!-- connect here: id="message1" -->
                                    <p class="card-text">Message: <span id="message12">Hello Alice</span></p>
                                    <p class="card-text">k: <span id="k"></span></p>
                                    <!-- connect here: id="hashed_signature1" 
                                    <p class="card-text">Hashed signature: <span id="hashed_signature1">?</span></p>-->
                                    <!-- connect here: id="hashed_message1" 
                                    <p class="card-text">Hashed message: <span id="hashed_message1">?</span></p>-->
                                    <!-- connect here: id="encrypted_signature1" -->
                                    <p class="card-text">Signature: <span id="Signature1">?</span></p>
                                    <!-- connect here: id="encrypted_message1" -->
                                    <p class="card-text">Encrypted message: <span id="encrypted_message1">?</span></p>
                                </div>
                            </div>

                            <div class="card">
                                <div class="card-header">
                                    <h5 class="text-center">Receiver</h5>
                                </div>
                                <div class="card-body">
                                    <p class="card-text">Alice receives the message from Bob.</p>
                                    <!-- connect here: id="signature2" -->
                                    <p class="card-text">Receiver: Alice</p>
                                    <!-- connect here: id="decrypted_message1" -->
                                    <p class="card-text">Decrypt message: <span id="decrypted_message1">?</span></p>
                                    <!-- connect here: id="decrypted_signature1" -->
                                    <p class="card-text">Verify signature: <span id="verify1"></span></p>
                                    <p class = "card-text">v1 = </span><span id="v1-1">v1</span></p>
                                    <p class = "card-text">v2 = </span><span id="v2-1">v2</span></p>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>

                <!-- From Alice to Bob  -->
                <div class="card my-5">
                    <div class="card-header">
                        <h4>From: Alice, to: Bob</h4>
                    </div>
                    <div class="card-body">
                        <h6 class="fw-bold">&rArr; Sending & Receving Process:</h6>
                        <div class="card-group">
                                
                            <div class="card">
                                <div class="card-header">
                                    <h5 class="text-center">Sender</h5>
                                </div>
                                <div class="card-body">
                                    <p class="card-text">Alice sends the message to Bob.</p>
                                    <!-- conect here: id="signature2" -->
                                    <p class="card-text">Sender: Alice</p>
                                    <!-- connect here: id="message2" -->
                                    <p class="card-text">Message: <span id="message22">Hello Bob</span></p>
                                    <p class="card-text">k: <span id="k2"></span></p>
                                    <!-- connect here: id="hashed_signature1" 
                                    <p class="card-text">Hashed signature: <span id="hashed_signature1">?</span></p>-->
                                    <!-- connect here: id="hashed_message1" 
                                    <p class="card-text">Hashed message: <span id="hashed_message1">?</span></p>-->
                                    <!-- connect here: id="encrypted_signature1" -->
                                    <p class="card-text">Signature: <span id="Signature2">?</span></p>
                                    <!-- connect here: id="encrypted_message2" -->
                                    <p class="card-text">Encrypted message: <span id="encrypted_message2">?</span></p>
                                </div>
                            </div>

                            <div class="card">
                                <div class="card-header">
                                    <h5 class="text-center">Receiver</h5>
                                </div>
                                <div class="card-body">
                                    <p class="card-text">Bob receives the message from Alice.</p>
                                    <!-- connect here: id="signature2" -->
                                    <p class="card-text">Receiver: <span id="signature2">Bob</span></p>
                                    <!-- connect here: id="decrypted_message2" -->
                                    <p class="card-text">Decrypt message: <span id="decrypted_message2">?</span></p>
                                    <!-- connect here: id="decrypted_signature2" -->
                                    <p class="card-text">Verify signature: <span id="verify2">?</span></p>
                                    <p class = "card-text">v1 = </span><span id="v1-2">v1</span></p>
                                    <p class = "card-text">v2 = </span><span id="v2-2">v2</span></p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <footer class="text-center mt-auto py-3 text-white bg-dark fixed-bottom">
            <div class="text-center p-0.5">
              INT3230E - Cryptography & Information Security: Nguyễn Hữu Thế & Hoàng Kim Chi
            </div>
        </footer>
        <script>

            function isPrime(num) {
                if (num <= 1) return false;
                for (let i = 2; i <= Math.sqrt(num); i++) {
                  if (num % i === 0) return false;
                }
                return true;
              }
            
              // Hàm tính UCLN
              function gcd(a, b) {
                while (b !== 0) {
                  const temp = b;
                  b = a % b;
                  a = temp;
                }
                return a;
              }
            document.getElementById('system1_setting').addEventListener('submit', async function(e) {
                e.preventDefault();
                
                const p = document.getElementById('p1').value;
                const a = document.getElementById('privateKey1').value;
                const message = document.getElementById('message1').value;
                if (!isPrime(p)) {
                    alert("Số p phải là số nguyên tố!");
                    return;
                }

                if (a<=1 || a>=p-1) {
                    alert("Private key a cần thỏa mãn: 1 < a < p-1");
                    return;
                }
                const response = await fetch('/sign_elgammal', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ p, a, message })
                });
                
                const result = await response.json();
                
                // Hiển thị kết quả trên giao diện
                document.getElementById('alpha1').innerHTML = result.alpha;
                document.getElementById('message12').innerText = message;
                document.getElementById('encrypted_message1').innerText = `(${result.encrypted_message[0]}, ${result.encrypted_message[1]})`;
                document.getElementById('Signature1').innerText = `(${result.signature[0]}, ${result.signature[1]})`;
                document.getElementById('decrypted_message1').innerText = message;
                document.getElementById('verify1').innerText = result.valid ? 'Valid' : 'Invalid';
                document.getElementById('v1-1').innerText = result.v1;
                document.getElementById('v2-1').innerText = result.v2;
                document.getElementById('k').innerText = result.k;
            });
            
            document.getElementById('system2_setting').addEventListener('submit', async function(e) {
                e.preventDefault();
                
                // Lấy dữ liệu từ các trường nhập liệu
                const p = document.getElementById('p2').value;
                const a = document.getElementById('privateKey2').value;
                const message = document.getElementById('message2').value;
                if (!isPrime(p)) {
                    alert("Số p phải là số nguyên tố!");
                    return;
                }

                if (a<=1 || a>=p-1) {
                    alert("Private key a cần thỏa mãn: 1 < a < p-1");
                    return;
                }
                // Gửi yêu cầu POST đến API '/sign_elgammal'
                const response = await fetch('/sign_elgammal', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ p, a, message })
                });
                
                // Nhận kết quả từ phản hồi của API
                const result = await response.json();
                
                // Hiển thị kết quả trên giao diện
                document.getElementById('alpha2').innerText = result.alpha;
                document.getElementById('message22').innerText = message;
                document.getElementById('encrypted_message2').innerText = `(${result.encrypted_message[0]}, ${result.encrypted_message[1]})`;
                document.getElementById('Signature2').innerText = `(${result.signature[0]}, ${result.signature[1]})`;
                document.getElementById('decrypted_message2').innerText = message;
                document.getElementById('verify2').innerText = result.valid ? 'Valid' : 'Invalid';
                document.getElementById('v1-2').innerText = result.v1;
                document.getElementById('v2-2').innerText = result.v2;
                document.getElementById('k2').innerText = result.k;
            });
            
            
        </script>
    </body>

</html>
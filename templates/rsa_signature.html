<!DOCTYPE html>
<html lang="en">

    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>RSA Signature</title>
        <link rel="stylesheet" href="{{ url_for('static', filename='css/bootstrap.css') }}">
    </head>

    <body>
        <script src="{{ url_for('static', filename='js/bootstrap.bundle.min.js') }}"></script>

        <header>
            <nav class="navbar fixed-top navbar-expand-lg bg-dark navbar-dark">
                <div class="container-fluid">
                  <!-- link to homescreen -->
                  <a class="navbar-brand" href="#">
                    <img src="" alt="">
                    INT3230E
                  </a>
                  <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                  </button>
                  <div class="collapse navbar-collapse" id="navbarSupportedContent">
                    <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                      <li class="nav-item dropdown">
                          <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="true">
                            RSA
                          </a>
                          <ul class="dropdown-menu">
                              <li><a class="dropdown-item" href="/">RSA</a></li>
                              <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item" href="/rsa-signature">RSA Digital Signature</a></li>
                          </ul>
                      </li>
        
                      <li class="nav-item dropdown">
                          <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="true">
                            ElGammal
                          </a>
                          <ul class="dropdown-menu">
                              <li><a class="dropdown-item" href="/elgammal">Elgammal</a></li>
                              <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item" href="/elgammal-signature">Elgammal Digital Signature</a></li>
                          </ul>
                      </li>
        
                      <li class="nav-item dropdown">
                          <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="true">
                            Elliptic
                          </a>
                          <ul class="dropdown-menu">
                              <li><a class="dropdown-item" href="/elliptic">ECC</a></li>
                              <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item" href="/elliptic-signature">ECC Digital Signature</a></li>
                          </ul>
                      </li>
        
                      <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="true">
                          Fundamentals
                        </a>
                        <ul class="dropdown-menu">
                          <li><a class="dropdown-item" href="/euclid">Euclid algorithm</a></li>
                          <li><a class="dropdown-item" href="/primality">Primality test</a></li>
                          <li><hr class="dropdown-divider"></li>
                          <li><a class="dropdown-item" href="other.html">Something else here</a></li>
                        </ul>
                      </li>
                    </ul>
                  </div>
                </div>
            </nav>
        </header>

        <main>
            <div class="pt-5 mb-5">
                <div class="container mt-3">
                    <h1 class="text-center">RSA Signature</h1>

                    <div class="row mt-5">

                        <div class="card-group">
                            <div class="card mb-3" style="max-width: 540px;">
                                <div class="row g-0">
                                  <div class="col-md-4">
                                    <img src="https://media.geeksforgeeks.org/wp-content/uploads/20201212145658/step1.jpg" class="img-fluid rounded-start" alt="...">
                                  </div>
                                  <div class="col-md-8">
                                    <div class="card-body">
                                      <h5 class="card-title">Step 1</h5>
                                      <p class="card-text">Sender A uses the SHA-1 Message Digest Algorithm to calculate the message digest (MD1) over the original message M.</p>
                                      <p class="card-text"><small class="text-body-secondary">Image: Message digest calculation</small></p>
                                    </div>
                                  </div>
                                </div>
                            </div>

                            <div class="card mb-3 ms-5" style="max-width: 540px;">
                                <div class="row g-0">
                                  <div class="col-md-4">
                                    <img src="https://media.geeksforgeeks.org/wp-content/uploads/20201212145816/step4.jpg" class="img-fluid rounded-start" alt="...">
                                  </div>
                                  <div class="col-md-8">
                                    <div class="card-body">
                                      <h5 class="card-title">Step 4</h5>
                                      <p class="card-text">When B receives the Original Message(M) and the Digital Signature(DS) from A, it first uses the same message-digest algorithm as was used by A and calculates its own Message Digest (MD2) for M.</p>
                                      <p class="card-text"><small class="text-body-secondary">Image: Receiver calculates its own message digest</small></p>
                                    </div>
                                  </div>
                                </div>
                            </div>
                        </div>


                        <div class="card-group">

                            <div class="card mb-3" style="max-width: 540px;">
                                <div class="row g-0">
                                  <div class="col-md-4">
                                    <img src="https://media.geeksforgeeks.org/wp-content/uploads/20201212145725/step2.jpg" class="img-fluid rounded-start" alt="...">
                                    <p class="card-text text-center m-3"><small class="text-body-secondary">Image: Digital signature creation</small></p>
                                  </div>
                                  <div class="col-md-8">
                                    <div class="card-body">
                                      <h5 class="card-title">Step 2</h5>
                                      <p class="card-text">A now encrypts the message digest with its private key. The output of this process is called Digital Signature (DS) of A.</p>

                                    </div>
                                  </div>
                                </div>
                            </div>

                            <div class="card mb-3 ms-5" style="max-width: 540px;">
                                <div class="row g-0">
                                  <div class="col-md-4">
                                    <img src="https://media.geeksforgeeks.org/wp-content/uploads/20201212145841/step5.jpg" class="img-fluid rounded-start" alt="...">
                                    <p class="card-text text-center m-3"><small class="text-body-secondary">Image: Receiver retrieves sender’s message digest</small></p>
                                  </div>
                                  <div class="col-md-8">
                                    <div class="card-body">
                                      <h5 class="card-title">Step 5</h5>
                                      <p class="card-text">Now B uses A’s public key to decrypt the digital signature because it was encrypted by A’s private key. The result of this process is the original Message Digest (MD1) which was calculated by A.</p>
                                      
                                    </div>
                                  </div>
                                </div>
                            </div>

                        </div>

                        <div class="card-group">

                            <div class="card mb-3" style="max-width: 540px;">
                                <div class="row g-0">
                                  <div class="col-md-4">
                                    <img src="https://media.geeksforgeeks.org/wp-content/uploads/20201212151145/step3.jpg" class="img-fluid rounded-start" alt="...">
                                    <p class="card-text text-center m-3"><small class="text-body-secondary">Image: Transmission of original message and digital signature simultaneously</small></p>
                                  </div>
                                  <div class="col-md-8">
                                    <div class="card-body">
                                      <h5 class="card-title">Step 3</h5>
                                      <p class="card-text">Now sender A sends the digital signature (DS) along with the original message (M) to B.</p>

                                    </div>
                                  </div>
                                </div>
                            </div>

                            <div class="card mb-3 ms-5" style="max-width: 540px;">
                                <div class="row g-0">
                                  <div class="col-md-4">
                                    <img src="https://media.geeksforgeeks.org/wp-content/uploads/20201212145912/step6.jpg" class="img-fluid rounded-start" alt="...">
                                    <p class="card-text text-center m-3"><small class="text-body-secondary">Image: Verification of the digital signature</small></p>
                                  </div>
                                  <div class="col-md-8">
                                    <div class="card-body">
                                      <h5 class="card-title
                                        ">Step 6</h5>
                                        <p class="card-text">B compares the Message Digest (MD2) calculated by itself with the Message Digest (MD1) received from A. If both are the same, then the digital signature is verified.</p>
                                    </div>
                                  </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <h1 class="text-center mt-5">Example</h1>

                    <div class="card-group mt-5">

                        <div class="card">
                            <div class="card-header">
                                <h4>Bob</h4>
                            </div>
                            <div class="card-body">

                                <!-- connect here: id="rsa system setting" -->
                                <form id="system1_setting">
                                    <div class="mb-3 row">
                                        <label for="primeP" class="col-sm-2 col-form-label"><i>p</i> =</label>
                                        <div class="col-sm-10">
                                            <!-- connect here: id="p1" -->
                                            <input type="number" class="form-control" id="p1" placeholder="11" required />
                                        </div>
                                    </div>
                                    <div class="mb-3 row">
                                        <label for="primeQ" class="col-sm-2 col-form-label"><i>q</i> =</label>
                                        <div class="col-sm-10">
                                            <!-- connect here: id="q1" -->
                                            <input type="number" class="form-control" id="q1" placeholder="13" required />
                                        </div>
                                    </div>

                                    <div class="mb-3 row">
                                      <label for="primeQ" class="col-sm-2 col-form-label"><i>e</i> =</label>
                                      <div class="col-sm-10">
                                          <!-- connect here: id="q1" -->
                                          <input type="number" class="form-control" id="e1" placeholder="7" required />
                                      </div>
                                  </div>

                                    <div class="mb-3 row">
                                        <label for="message" class="col-sm-2 col-form-label">Message:</label>
                                        <div class="col-sm-10">
                                            <!-- connect here: id="message1" -->
                                            <input type="text" class="form-control" id="message1" placeholder="Hello Alice" required />
                                        </div>
                                    </div>

                                    <div class="d-flex justify-content-begin">
                                        <!-- connect here: handle form submission -->
                                        <button type="submit" class="btn btn-primary">Submit</button>
                                    </div>
                                </form>
                            </div>
                        </div>

                        <div class="card">
                            <div class="card-header">
                                <h4>Alice</h4>
                            </div>
                            <div class="card-body">

                                <!-- connect here: id="rsa system setting" -->
                                <form id="system2_setting">
                                    <div class="mb-3 row">
                                        <label for="primeP2" class="col-sm-2 col-form-label"><i>p</i> =</label>
                                        <div class="col-sm-10">
                                            <!-- connect here: id="p2" -->
                                            <input type="number" class="form-control" id="p2" placeholder="11" required />
                                        </div>
                                    </div>
                                    <div class="mb-3 row">
                                        <label for="primeQ2" class="col-sm-2 col-form-label"><i>q</i> =</label>
                                        <div class="col-sm-10">
                                            <!-- connect here: id="q2" -->
                                            <input type="number" class="form-control" id="q2" placeholder="13" required />
                                        </div>
                                    </div>

                                    <div class="mb-3 row">
                                      <label for="primeQ" class="col-sm-2 col-form-label"><i>e</i> =</label>
                                      <div class="col-sm-10">
                                          <!-- connect here: id="q1" -->
                                          <input type="number" class="form-control" id="e2" placeholder="7" required />
                                      </div>
                                  </div>

                                    <div class="mb-3 row">
                                        <label for="message2" class="col-sm-2 col-form-label">Message:</label>
                                        <div class="col-sm-10">
                                            <!-- connect here: id="message2" -->
                                            <input type="text" class="form-control" id="message2" placeholder="Hello Bob" required />
                                        </div>
                                    </div>

                                    <div class="d-flex justify-content-begin">
                                        <!-- connect here: handle form submission -->
                                        <button type="submit" class="btn btn-primary">Submit</button>
                                    </div>
                                </form>
                            </div>
                        </div>

                    </div>

                    <!-- From Bob to Alice  -->
                    <div class="card my-5">
                        <div class="card-header">
                          <h4>From: Bob, to: Alice</h4>
                        </div>
                        <div class="card-body">
                            <h6 class="fw-bold">&rArr; Sending & Receving Process:</h6>
                            <div class="card-group mt-3">

                                <div class="card">
                                    <div class="card-header">
                                        <h5 class="text-center">Sender</h5>
                                    </div>
                                    <div class="card-body">
                                        <p class="card-text">Bob sends the message to Alice.</p>
                                        <!-- conect here: id="hash_signature1" -->
                                        <p class="card-text">Sender: Bob</span></p>
                                        <!-- connect here: id="message1" -->
                                        <p class="card-text">Message: <span id="message1">Hello Alice</span></p>
                                        <!-- connect here: id="hashed_message1" -->
                                        <p class="card-text">Hashed message: <span id="hashed_message1">?</span></p>
                                        <!-- connect here: id="encrypted_signature1" -->
                                        <p class="card-text">Signature: <span id="signature1">?</span></p>
                                        <!-- connect here: id="encrypted_message1" -->
                                        <p class="card-text">Encrypted message: <span id="encrypted_message1">?</span></p>

                                        <p class="card-text">Bob public key: <span id="Bob_public_key">(n, e)</span></p>

                                        <p class="card-text">Bob private key: <span id="Bob_private_key">(n, d)</span></p>
                                    </div>
                                </div>

                                <div class="card">
                                    <div class="card-header">
                                        <h5 class="text-center">Receiver</h5>
                                    </div>
                                    <div class="card-body">
                                        <p class="card-text">Alice receives the message from Bob.</p>
                                        <!-- connect here: id="signature2" -->
                                        <p class="card-text">Receiver: Alice</span></p>
                                        <!-- connect here: id="decrypted_message1" -->
                                        <p class="card-text">Decrypt message: <span id="decrypted_message1">?</span></p>
                                        <!-- connect here: id="decrypted_signature1" -->
                                        <p class="card-text">Verify signature: <span id="verify1">?</span></p>
                                        <p class="card-text">V = <span id="signature12">121</span><sup><span id="e12">103</span></sup> mod <span id="n12">143</span> = <span id="v1">?</span></p>
                                    </div>
                                </div>

                            </div>
                        </div>
                    </div>

                    <!-- From Alice to Bob  -->
                    <div class="card my-5">
                        <div class="card-header">
                          <h4>From: Alice, to: Bob</h4>
                        </div>
                        <div class="card-body">
                            <h6 class="fw-bold">&rArr; Sending & Receving Process:</h6>
                            <div class="card-group">
                                    
                                <div class="card">
                                    <div class="card-header">
                                        <h5 class="text-center">Sender</h5>
                                    </div>
                                    <div class="card-body">
                                      <p class="card-text">Alice sends the message to Bob.</p>
                                      <!-- conect here: id="hash_signature1" -->
                                      <p class="card-text">Sender: Alice</span></p>
                                      <!-- connect here: id="message1" -->
                                      <p class="card-text">Message: <span id="message2">Hello Bob</span></p>
                                      <!-- connect here: id="hashed_message2" -->
                                      <p class="card-text">Hashed message: <span id="hashed_message2">?</span></p>
                                      <!-- connect here: id="encrypted_signature2" -->
                                      <p class="card-text">Signature: <span id="signature2">?</span></p>
                                      <!-- connect here: id="encrypted_message2" -->
                                      <p class="card-text">Encrypted message: <span id="encrypted_message2">?</span></p>

                                      <p class="card-text">Alice public key: <span id="Alice_public_key">(n, e)</span></p>

                                      <p class="card-text">Alice private key: <span id="Alice_private_key">(n, d)</span></p>
                                  </div>
                              </div>

                              <div class="card">
                                  <div class="card-header">
                                      <h5 class="text-center">Receiver</h5>
                                  </div>
                                  <div class="card-body">
                                      <p class="card-text">Bob receives the message from Bob.</p>
                                      <!-- connect here: id="signature2" -->
                                      <p class="card-text">Receiver: Bob</p>
                                      <!-- connect here: id="decrypted_message1" -->
                                      <p class="card-text">Decrypt message: <span id="decrypted_message2">?</span></p>
                                      <!-- connect here: id="decrypted_signature1" -->
                                      <p class="card-text">Verify signature: <span id="verify2">?</span></p>
                                      <p class="card-text">V = <span id="signature22">121</span><sup><span id="e22">103</span></sup> mod <span id="n22">143</span> = <span id="v2">?</span></p>
                                  </div>
                              </div>

                            </div>
                        </div>
                    </div>

                </div>
            </div>

        </main>

        <footer class="text-center mt-auto py-3 text-white bg-dark fixed-bottom">
            <div class="text-center p-0.5">
              INT3230E - Cryptography & Information Security: Nguyễn Hữu Thế & Hoàng Kim Chi
            </div>
        </footer>
    </body>
    <script>
      document.addEventListener("DOMContentLoaded", () => {
        // Hàm kiểm tra số nguyên tố
        function isPrime(num) {
          if (num <= 1) return false;
          for (let i = 2; i <= Math.sqrt(num); i++) {
            if (num % i === 0) return false;
          }
          return true;
        }
      
        // Hàm tính UCLN
        function gcd(a, b) {
          while (b !== 0) {
            const temp = b;
            b = a % b;
            a = temp;
          }
          return a;
        }
      
        // Lấy form system1_setting
        const signForm = document.getElementById("system1_setting");
        const signForm2 = document.getElementById("system2_setting");
      
        // Gắn sự kiện submit
        signForm.addEventListener("submit", async (e) => {
          e.preventDefault(); // Ngăn chặn hành động mặc định của form
      
          // Thu thập dữ liệu từ các input
          const p = parseInt(document.getElementById("p1").value, 10);
          const q = parseInt(document.getElementById("q1").value, 10);
          const eValue = parseInt(document.getElementById("e1").value, 10);
          const message = document.getElementById("message1").value;
      
          // Kiểm tra p và q có phải số nguyên tố không
          if (!isPrime(p)) {
            alert("Số P phải là số nguyên tố!");
            return;
          }
      
          if (!isPrime(q)) {
            alert("Số Q phải là số nguyên tố!");
            return;
          }
      
          // Tính n và phi(n)
          const n = p * q;
          const phiN = (p - 1) * (q - 1);
      
          // Kiểm tra e nguyên tố cùng nhau với phi(n)
          if (gcd(eValue, phiN) !== 1) {
            alert("Số E phải là số nguyên tố cùng nhau với φ(n)!");
            return;
          }
      
          // Chuẩn bị dữ liệu cho API
          const requestData = {
            p: p,
            q: q,
            e: eValue,
            message: message,
          };
      
          try {
            // Gửi yêu cầu POST đến API
            const response = await fetch("/sign-rsa", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify(requestData),
            });
      
            // Xử lý phản hồi từ API
            const data = await response.json();
      
            // Kiểm tra phản hồi
            if (response.ok) {
              // Hiển thị kết quả lên giao diện
              document.getElementById("encrypted_message1").textContent =
                data.encrypted_message;
              document.getElementById("signature1").textContent = data.signature;
              document.getElementById("signature12").textContent = data.signature;
              document.getElementById("hashed_message1").textContent =
              data.V;
              document.getElementById("Bob_public_key").textContent = `(${data.public_key[0]}, ${data.public_key[1]})`;
              document.getElementById("Bob_private_key").textContent = `(${data.private_key[0]}, ${data.private_key[1]})`
              document.getElementById("decrypted_message1").textContent =
                data.decrypt_message;
              document.getElementById("v1").textContent = data.V;
              document.getElementById("e12").textContent = eValue;
              document.getElementById("n12").textContent = n;
              document.getElementById("verify1").textContent = "Valid";
            } else {
              console.error("Error:", data.error || "Unknown error");
            }
          } catch (error) {
            console.error("Error sending request:", error);
          }
        });
        signForm2.addEventListener("submit", async (e) => {
          e.preventDefault(); // Ngăn chặn hành động mặc định của form
      
          // Thu thập dữ liệu từ các input
          const p = parseInt(document.getElementById("p2").value, 10);
          const q = parseInt(document.getElementById("q2").value, 10);
          const eValue = parseInt(document.getElementById("e2").value, 10);
          const message = document.getElementById("message2").value;
      
          // Kiểm tra p và q có phải số nguyên tố không
          if (!isPrime(p)) {
            alert("Số P phải là số nguyên tố!");
            return;
          }
      
          if (!isPrime(q)) {
            alert("Số Q phải là số nguyên tố!");
            return;
          }
      
          // Tính n và phi(n)
          const n = p * q;
          const phiN = (p - 1) * (q - 1);
      
          // Kiểm tra e nguyên tố cùng nhau với phi(n)
          if (gcd(eValue, phiN) !== 1) {
            alert("Số E phải là số nguyên tố cùng nhau với φ(n)!");
            return;
          }
      
          // Chuẩn bị dữ liệu cho API
          const requestData = {
            p: p,
            q: q,
            e: eValue,
            message: message,
          };
      
          try {
            // Gửi yêu cầu POST đến API
            const response = await fetch("/sign-rsa", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify(requestData),
            });
      
            // Xử lý phản hồi từ API
            const data = await response.json();
      
            // Kiểm tra phản hồi
            if (response.ok) {
              // Hiển thị kết quả lên giao diện
              document.getElementById("encrypted_message2").textContent =
                data.encrypted_message;
              document.getElementById("signature2").textContent = data.signature;
              document.getElementById("signature22").textContent = data.signature;
              document.getElementById("hashed_message2").textContent =
              data.V;
              document.getElementById("Alice_public_key").textContent = `(${data.public_key[0]}, ${data.public_key[1]})`;
              document.getElementById("Alice_private_key").textContent = `(${data.private_key[0]}, ${data.private_key[1]})`
              document.getElementById("decrypted_message2").textContent =
                data.decrypt_message;
              document.getElementById("v2").textContent = data.V;
              document.getElementById("e22").textContent = eValue;
              document.getElementById("n22").textContent = n;
              document.getElementById("verify2").textContent = "Valid";
            } else {
              console.error("Error:", data.error || "Unknown error");
            }
          } catch (error) {
            console.error("Error sending request:", error);
          }
        });
      });
      
    </script>
</html>